# NeuroScraper Pro

**Профессиональный Telegram-бот для парсинга аудитории и контента**

## Описание

NeuroScraper Pro - это мощный инструмент для сбора целевой аудитории из Telegram каналов и чатов. Бот позволяет парсить активных пользователей с гибкими фильтрами по времени активности и генерирует детальные отчеты в Excel и TXT форматах.

## Основные возможности

### Типы парсинга

- **Парсинг каналов - Последние посты** - Сбор активных пользователей из комментариев к последним постам канала
- **Парсинг каналов - Конкретный пост** - Сбор комментаторов только из одного указанного поста
- **Парсинг чатов (группы)** - Извлечение участников из публичных и закрытых чатов

### Временные фильтры

- Активные за неделю (7 дней)
- Активные за месяц (30 дней)
- Активные за 3 месяца (90 дней)

### Многоаккаунтность

- Системная сессия для публичных ресурсов
- Добавление пользовательских аккаунтов для закрытых чатов
- Безопасное хранение сессий локально

### Детальные отчеты

#### Excel отчет (.xlsx)

- **Лист "Users"**: Username, UserID, FullName, LastActivityDate, MessageCount
- **Лист "Admins"**: Отдельный список администраторов
- **Лист "Raw Data"**: Сырые данные сообщений
- **Лист "Statistics"**: Статистика парсинга

#### TXT отчет (.txt)

- Простой список юзернеймов (по одному на строку)
- Формат: `@username`
- Готов для загрузки в софт для рассылок

### Система лимитов

- 10 бесплатных парсингов для новых пользователей
- Премиум подписка для безлимитного доступа
- Админ-панель для управления пользователями

## Технологический стек

- **Python 3.11+**
- **Aiogram 3.x** - Telegram Bot Framework
- **Telethon** - MTProto клиент для парсинга
- **Pandas** - Обработка данных
- **OpenPyXL** - Генерация Excel отчетов
- **SQLite** - База данных
- **aiosqlite** - Асинхронная работа с БД

## Установка

### 1. Клонирование репозитория

```bash
git clone <repository_url>
cd "NeuroScraper Pro"
```

### 2. Создание виртуального окружения

```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка переменных окружения

Создайте файл `.env` на основе `.env.example`:

```bash
cp .env.example .env
```

Заполните `.env` своими данными:

```env
BOT_TOKEN=your_bot_token_here
ADMIN_ID=your_telegram_id
API_ID=your_api_id
API_HASH=your_api_hash
SUPPORT_LINK=https://t.me/your_support_bot
```

#### Получение API_ID и API_HASH

1. Перейдите на [https://my.telegram.org](https://my.telegram.org)
2. Войдите с вашим номером телефона
3. Перейдите в "API development tools"
4. Создайте новое приложение
5. Скопируйте `api_id` и `api_hash`

#### Получение BOT_TOKEN

1. Найдите [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям
4. Скопируйте полученный токен

#### Получение ADMIN_ID

1. Найдите [@userinfobot](https://t.me/userinfobot) в Telegram
2. Отправьте ему любое сообщение
3. Скопируйте ваш ID

## Запуск

```bash
python main.py
```

При успешном запуске вы увидите:

```
INFO - Starting NeuroScraper Pro Bot...
INFO - Database initialized
INFO - Directories created
INFO - Bot started successfully!
INFO - Starting polling...
```

## Использование

### Команды бота

- `/start` - Главное меню и приветствие
- `/help` - Справка по командам
- `/id` - Получить свой Telegram ID
- `/admin` - Админ-панель (только для администратора)

### Процесс парсинга

1. Выберите тип парсинга (Каналы или Чаты)
2. Выберите временной фильтр
3. Отправьте ссылку на цель парсинга
4. Дождитесь завершения
5. Получите два файла:
   - Excel отчет с полной информацией
   - TXT файл со списком юзернеймов

### Добавление аккаунта

1. Нажмите "Добавить аккаунт"
2. Введите номер телефона (+79991234567)
3. Введите код из Telegram
4. Если включена 2FA - введите пароль
5. Аккаунт добавлен!

### Админ-функции

Доступны только пользователю с `ADMIN_ID`:

- **Выдать премиум** - Предоставить безлимитный доступ пользователю
- **Забрать премиум** - Отозвать премиум статус у пользователя
- **Сбросить лимит** - Обнулить счетчик парсингов
- **Общая статистика** - Статистика бота (пользователи, парсинги)
- **Статистика пользователей** - Детальная информация по каждому пользователю (User ID, дата регистрации, дни в боте, количество парсингов)

## Структура проекта

```
NeuroScraper Pro/
├── config.py                 # Конфигурация и переменные окружения
├── database.py               # Управление базой данных
├── keyboards.py              # Инлайн-клавиатуры
├── main.py                   # Точка входа
├── requirements.txt          # Зависимости
├── .env                      # Переменные окружения (не в git)
├── .env.example             # Пример переменных окружения
├── .gitignore               # Git ignore правила
├── services/
│   ├── __init__.py
│   └── telethon_core.py     # Ядро парсинга (Telethon)
├── handlers/
│   ├── __init__.py
│   ├── user_handlers.py     # Обработчики пользователей
│   └── admin_handlers.py    # Обработчики админа
├── utils/
│   ├── __init__.py
│   └── excel_generator.py   # Генератор отчетов
├── sessions/                 # Хранилище сессий Telethon
└── reports/                  # Временные отчеты (генерируются)
```

## Безопасность

### Хранение данных

- Все сессии хранятся локально в папке `sessions/`
- Данные не передаются третьим лицам
- Используется официальное API Telegram

### Анти-детект

- Случайные задержки между запросами (0.5-2 сек)
- Корректная обработка `FloodWaitError`
- Имитация реального устройства через `device_model` и `system_version`

### Конфиденциальность

- ID администратора (`ADMIN_ID`) не включается в отчеты
- Пароли 2FA удаляются из чата после ввода

## Логирование

Логи записываются в:

- **Консоль** (stdout)
- **Файл** `bot.log`

Формат:

```
2025-01-10 12:00:00 - module_name - INFO - Message
```

## Решение проблем

### Ошибка "FloodWait"

Telegram ограничивает частоту запросов. Бот автоматически обрабатывает эти ошибки и ждет указанное время.

### Ошибка авторизации

- Проверьте правильность номера телефона
- Убедитесь, что код введен корректно
- Для 2FA используйте пароль облачного доступа (не SMS)

### Не находит канал/чат

- Для публичных: используйте ссылку или username
- Для закрытых: добавьте аккаунт, который состоит в чате

### База данных заблокирована

Убедитесь, что нет запущенных копий бота.

## FAQ

**Q: Сколько аккаунтов можно добавить?**
A: Неограниченно, но рекомендуется не более 5-10 для удобства.

**Q: Можно ли парсить приватные каналы?**
A: Да, добавьте аккаунт, который имеет доступ к каналу.

**Q: Безопасно ли использовать бота?**
A: Да, все сессии хранятся локально, используется официальное API.

**Q: Как получить премиум доступ?**
A: Обратитесь к администратору через бота.

## Поддержка

Для вопросов и поддержки обращайтесь:

- Telegram Support Bot (указан в `SUPPORT_LINK`)
- GitHub Issues (если репозиторий публичный)

## Лицензия

Этот проект создан в образовательных целях. Используйте ответственно и в соответствии с ToS Telegram.

## Автор

Разработано как профессиональный инструмент для маркетинга и аналитики Telegram.

---

**NeuroScraper Pro** © 2025
